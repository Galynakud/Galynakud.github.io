import React, { useEffect } from 'react'; 
import { useNavigate } from 'react-router-dom';

function Construction() {
  const navigate = useNavigate();
  useEffect(() => {
    const buildButton = document.getElementById("build-button");
    const grid = document.getElementById("grid");
    let selectedMaterial = null;

    document.querySelectorAll(".material-option").forEach(option => {
      option.addEventListener("click", function () {
        selectedMaterial = this.dataset.material;
        document.querySelectorAll(".material-option").forEach(el => el.classList.remove("selected"));
        this.classList.add("selected");
        buildButton.disabled = false;
      });
    });

    const materialPrices = {
      brick: 10,
      wood: 5,
      steel: 20,
      sand: 2,
      glass: 15,
      slate: 12
    };

    function createGrid(rows = 16, cols = 29) {
      grid.innerHTML = "";
      grid.style.display = "grid";
      grid.style.gridTemplateColumns = `repeat(${cols}, 30px)`;
      grid.style.gridTemplateRows = `repeat(${rows}, 30px)`;
      grid.style.gap = "2px";

      for (let i = 0; i < rows * cols; i++) {
        let cell = document.createElement("div");
        cell.classList.add("grid-cell");
        cell.style.width = "30px";
        cell.style.height = "30px";
        cell.style.border = "1px solid #ccc";
        cell.style.background = "#f0f0f0";
        cell.style.cursor = "pointer";
        cell.addEventListener("click", () => placeMaterial(cell));
        grid.appendChild(cell);
      }
    }

    function placeMaterial(cell) {
      if (!selectedMaterial) {
        alert("‚ùå –û–±–µ—Ä—ñ—Ç—å –º–∞—Ç–µ—Ä—ñ–∞–ª –ø–µ—Ä–µ–¥ —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è–º!");
        return;
      }
      cell.dataset.material = selectedMaterial;
      cell.style.background = getMaterialColor(selectedMaterial);
    }

    function getMaterialColor(material) {
      const colors = {
        brick: "#b33c2f",
        wood: "#8d6e63",
        steel: "#9d9d9d",
        sand: "#f4a261",
        glass: "#64b5f6",
        slate: "#363636"
      };
      return colors[material] || "#ffffff";
    }

    function startConstruction() {
      const materials = ["brick", "wood", "steel", "sand", "glass", "slate"];
      let resourceAmounts = {};

      materials.forEach(material => {
        resourceAmounts[material] = [...document.querySelectorAll(".grid-cell")]
          .filter(cell => cell.dataset.material === material).length;
      });

      if (Object.values(resourceAmounts).some(amount => amount > 0)) {
        localStorage.setItem("resources", JSON.stringify(resourceAmounts));
        console.log("–ü–µ—Ä–µ—Ö—ñ–¥ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω–∫—É resources.html...");
        navigate("/resources");
      } else {
        alert("‚ùå –í–∏ –Ω–µ –≤–∏–±—Ä–∞–ª–∏ –º–∞—Ç–µ—Ä—ñ–∞–ª–∏ –¥–ª—è –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞!");
      }
    }

    createGrid();
    buildButton.addEventListener("click", startConstruction);
  }, []);

  return (
    <>
      <section id="construction" className="info-section city-style">
        <div className="icon">üèóÔ∏è</div>
        <div className="text-content">
          <h2>–ë—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ</h2>
          <p>–†–æ–∑—à–∏—Ä—é–π—Ç–µ –º—ñ—Å—Ç–æ, –¥–æ–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ñ –æ–±'—î–∫—Ç–∏ —Ç–∞ –∫–µ—Ä—É–π—Ç–µ –±—É–¥—ñ–≤–µ–ª—å–Ω–∏–º–∏ —Ä–µ—Å—É—Ä—Å–∞–º–∏.</p>
        </div>
      </section>

      <section className="object-types">
        <h3>–¢–∏–ø–∏ –æ–±'—î–∫—Ç—ñ–≤</h3>
        <div className="types-list">
          <div className="type-item">
            <span className="type-icon">üè†</span>
            <h4>–ë—É–¥–∏–Ω–æ–∫</h4>
            <p>–ë—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–æ –∂–∏—Ç–ª–æ–≤–∏—Ö –±—É–¥–∏–Ω–∫—ñ–≤ –¥–ª—è —Ä–æ–∑—à–∏—Ä–µ–Ω–Ω—è –º—ñ—Å—Ç–∞, —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è –∂–∏—Ç–µ–ª—ñ–≤ —Ç–∞ —ó—Ö –ø–æ—Ç—Ä–µ–±.</p>
          </div>
          <div className="type-item">
            <span className="type-icon">üè≠</span>
            <h4>–§–∞–±—Ä–∏–∫–∞</h4>
            <p>–ü—Ä–æ–º–∏—Å–ª–æ–≤—ñ –æ–±'—î–∫—Ç–∏ –¥–ª—è –≤–∏—Ä–æ–±–Ω–∏—Ü—Ç–≤–∞ —Ç–æ–≤–∞—Ä—ñ–≤.</p>
          </div>
          <div className="type-item">
            <span className="type-icon">üè®</span>
            <h4>–ì–æ—Ç–µ–ª—å</h4>
            <p>–û–±'—î–∫—Ç–∏ –¥–ª—è —Ä–æ–∑–º—ñ—â–µ–Ω–Ω—è —Ç—É—Ä–∏—Å—Ç—ñ–≤ —Ç–∞ –±—ñ–∑–Ω–µ—Å-–ª—ñ–¥–µ—Ä—ñ–≤.</p>
          </div>
          <div className="type-item">
            <span className="type-icon">üè´</span>
            <h4>–®–∫–æ–ª–∞</h4>
            <p>–û—Å–≤—ñ—Ç–Ω—ñ–π –∑–∞–∫–ª–∞–¥ –¥–ª—è –Ω–∞–≤—á–∞–Ω–Ω—è –¥—ñ—Ç–µ–π —Ç–∞ –º–æ–ª–æ–¥—ñ.</p>
          </div>
        </div>
      </section>

      <section className="resources-tips">
        <h3>–†–µ—Å—É—Ä—Å–∏ –¥–ª—è –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞</h3>
        <p>–û—Å—å –∫—ñ–ª—å–∫–∞ –æ—Å–Ω–æ–≤–Ω–∏—Ö –º–∞—Ç–µ—Ä—ñ–∞–ª—ñ–≤, —è–∫—ñ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é—Ç—å—Å—è –ø—Ä–∏ –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤—ñ —Ä—ñ–∑–Ω–∏—Ö —Ç–∏–ø—ñ–≤ –æ–±'—î–∫—Ç—ñ–≤.</p>
        <div className="tips-list">
          <div className="tip-item"><span className="tip-icon">üß±</span><h4>–¶–µ–≥–ª–∞</h4><p>–¶–µ–≥–ª–∞ —î –æ—Å–Ω–æ–≤–Ω–∏–º –º–∞—Ç–µ—Ä—ñ–∞–ª–æ–º –¥–ª—è —Å—Ç—ñ–Ω–æ–≤–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π.</p></div>
          <div className="tip-item"><span className="tip-icon">ü™µ</span><h4>–î–µ—Ä–µ–≤–æ</h4><p>–î–µ—Ä–µ–≤–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞ –∫–∞—Ä–∫–∞—Å—ñ–≤, –¥–∞—Ö—É —Ç–∞ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω–∏—Ö –µ–ª–µ–º–µ–Ω—Ç—ñ–≤.</p></div>
          <div className="tip-item"><span className="tip-icon">ü™®</span><h4>–°—Ç–∞–ª—å</h4><p>–°—Ç–∞–ª—å –ø–æ—Ç—Ä—ñ–±–Ω–∞ –¥–ª—è –∑–º—ñ—Ü–Ω–µ–Ω–Ω—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π, –æ—Å–æ–±–ª–∏–≤–æ –¥–ª—è —Ñ–∞–±—Ä–∏–∫ —Ç–∞ –≤–∏—Å–æ—Ç–Ω–∏—Ö –±—É–¥—ñ–≤–µ–ª—å.</p></div>
          <div className="tip-item"><span className="tip-icon">üèñÔ∏è</span><h4>–ü—ñ—Å–æ–∫</h4><p>–ü—ñ—Å–æ–∫ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –ø—Ä–∏ –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤—ñ –≤–µ–ª–∏–∫–∏—Ö –æ–±'—î–∫—Ç—ñ–≤, —Ç–∞–∫–∏—Ö —è–∫ –¥–æ—Ä–æ–≥–∏ —Ç–∞ –ø–∞—Ä–∫–∏.</p></div>
          <div className="tip-item"><span className="tip-icon">ü™û</span><h4>–°–∫–ª–æ</h4><p>–°–∫–ª–æ –Ω–µ–æ–±—Ö—ñ–¥–Ω–µ –¥–ª—è –≤–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—è –ø—Ä–æ–∑–æ—Ä–∏—Ö –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü—ñ–π, —Ç–∞–∫–∏—Ö —è–∫ —Ñ–∞—Å–∞–¥–∏ —Ç–∞ —ñ–Ω—Ç–µ—Ä'—î—Ä–Ω—ñ –µ–ª–µ–º–µ–Ω—Ç–∏.</p></div>
          <div className="tip-item"><span className="tip-icon">ü™∂</span><h4>–®–∏—Ñ–µ—Ä</h4><p>–®–∏—Ñ–µ—Ä –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è –¥–ª—è –ø–æ–∫—Ä–∏—Ç—Ç—è –¥–∞—Ö—ñ–≤, –∑–∞–±–µ–∑–ø–µ—á—É—é—á–∏ –º—ñ—Ü–Ω—ñ—Å—Ç—å —ñ –¥–æ–≤–≥–æ–≤—ñ—á–Ω—ñ—Å—Ç—å.</p></div>
        </div>
      </section>

      <section className="construction-controlss">
        <h3>–û–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –±—É–¥—ñ–≤–ª—ñ</h3>
        <div className="object-selectionn">
          <div className="object-optionn" data-type="building">
            <img src="/images/house.png" alt="–ë—É–¥–∏–Ω–æ–∫" />
            <p>–ë—É–¥–∏–Ω–æ–∫</p>
          </div>
          <div className="object-optionn" data-type="factory">
            <img src="/images/factory.png" alt="–§–∞–±—Ä–∏–∫–∞" />
            <p>–§–∞–±—Ä–∏–∫–∞</p>
          </div>
          <div className="object-optionn" data-type="hotel">
            <img src="/images/hotel.png" alt="–ì–æ—Ç–µ–ª—å" />
            <p>–ì–æ—Ç–µ–ª—å</p>
          </div>
          <div className="object-optionn" data-type="school">
            <img src="/images/school.png" alt="–®–∫–æ–ª–∞" />
            <p>–®–∫–æ–ª–∞</p>
          </div>
        </div>

        <h3>–ü–∞—Ä–∞–º–µ—Ç—Ä–∏ –±—É–¥—ñ–≤–Ω–∏—Ü—Ç–≤–∞</h3>
        <div className="material-options-container">
          <div className="material-option" data-material="brick">üß± –¶–µ–≥–ª–∞</div>
          <div className="material-option" data-material="wood">ü™µ –î–µ—Ä–µ–≤–æ</div>
          <div className="material-option" data-material="steel">üî© –°—Ç–∞–ª—å</div>
          <div className="material-option" data-material="sand">üèñÔ∏è –ü—ñ—Å–æ–∫</div>
          <div className="material-option" data-material="glass">ü™û –°–∫–ª–æ</div>
          <div className="material-option" data-material="slate">ü™∂ –®–∏—Ñ–µ—Ä</div>
        </div>

        <section className="grid-container">
          <div id="grid"></div>
        </section>

        <button type="button" id="build-button" disabled>üèóÔ∏è –î–æ–¥–∞—Ç–∏ –æ–±'—î–∫—Ç</button>
      </section>
    </>
  );
}

export default Construction;
